# Skynet

# Enumeration

## Nmap

### Quick Scan

    ```bash
    # Nmap 7.60 scan initiated Fri May 14 20:09:26 2021 as: nmap -sC -sV -vv -oN quick.nmap 10.10.173.69
    Nmap scan report for ip-10-10-173-69.eu-west-1.compute.internal (10.10.173.69)
    Host is up, received arp-response (0.00092s latency).
    Scanned at 2021-05-14 20:09:27 BST for 13s
    Not shown: 994 closed ports
    Reason: 994 resets
    PORT    STATE SERVICE     REASON         VERSION
    22/tcp  open  ssh         syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
    | ssh-hostkey:
    |   2048 99:23:31:bb:b1:e9:43:b7:56:94:4c:b9:e8:21:46:c5 (RSA)
    | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKeTyrvAfbRB4onlz23fmgH5DPnSz07voOYaVMKPx5bT62zn7eZzecIVvfp5LBCetcOyiw2Yhocs0oO1/RZSqXlwTVzRNKzznG4WTPtkvD7ws/4tv2cAGy1lzRy9b+361HHIXT8GNteq2mU+boz3kdZiiZHIml4oSGhI+/+IuSMl5clB5/FzKJ+mfmu4MRS8iahHlTciFlCpmQvoQFTA5s2PyzDHM6XjDYH1N3Euhk4xz44Xpo1hUZnu+P975/GadIkhr/Y0N5Sev+Kgso241/v0GQ2lKrYz3RPgmNv93AIQ4t3i3P6qDnta/06bfYDSEEJXaON+A9SCpk2YSrj4A7
    |   256 57:c0:75:02:71:2d:19:31:83:db:e4:fe:67:96:68:cf (ECDSA)
    | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI0UWS0x1ZsOGo510tgfVbNVhdE5LkzA4SWDW/5UjDumVQ7zIyWdstNAm+lkpZ23Iz3t8joaLcfs8nYCpMGa/xk=
    |   256 46:fa:4e:fc:10:a5:4f:57:57:d0:6d:54:f6:c3:4d:fe (EdDSA)
    |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICHVctcvlD2YZ4mLdmUlSwY8Ro0hCDMKGqZ2+DuI0KFQ
    80/tcp  open  http        syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))
    | http-methods:
    |_  Supported Methods: GET HEAD POST OPTIONS
    |_http-server-header: Apache/2.4.18 (Ubuntu)
    |_http-title: Skynet
    110/tcp open  pop3        syn-ack ttl 64 Dovecot pop3d
    |_pop3-capabilities: RESP-CODES TOP PIPELINING UIDL SASL AUTH-RESP-CODE CAPA
    139/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
    143/tcp open  imap        syn-ack ttl 64 Dovecot imapd
    |_imap-capabilities: ENABLE LOGINDISABLEDA0001 listed have more LOGIN-REFERRALS post-login IDLE SASL-IR LITERAL+ ID capabilities OK IMAP4rev1 Pre-login
    445/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
    MAC Address: 02:37:C8:F8:91:DD (Unknown)
    Service Info: Host: SKYNET; OS: Linux; CPE: cpe:/o:linux:linux_kernel

    Host script results:
    |_clock-skew: mean: -1s, deviation: 0s, median: -1s
    | nbstat: NetBIOS name: SKYNET, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
    | Names:
    |   SKYNET<00>           Flags: <unique><active>
    |   SKYNET<03>           Flags: <unique><active>
    |   SKYNET<20>           Flags: <unique><active>
    |   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
    |   WORKGROUP<00>        Flags: <group><active>
    |   WORKGROUP<1d>        Flags: <unique><active>
    |   WORKGROUP<1e>        Flags: <group><active>
    | Statistics:
    |   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
    |   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
    |_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
    | p2p-conficker:
    |   Checking for Conficker.C or higher...
    |   Check 1 (port 13874/tcp): CLEAN (Couldn't connect)
    |   Check 2 (port 64053/tcp): CLEAN (Couldn't connect)
    |   Check 3 (port 45034/udp): CLEAN (Failed to receive data)
    |   Check 4 (port 22119/udp): CLEAN (Failed to receive data)
    |_  0/4 checks are positive: Host is CLEAN or ports are blocked
    | smb-os-discovery:
    |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
    |   Computer name: skynet
    |   NetBIOS computer name: SKYNET\x00
    |   Domain name: \x00
    |   FQDN: skynet
    |_  System time: 2021-05-14T14:09:39-05:00
    | smb-security-mode:
    |   account_used: guest
    |   authentication_level: user
    |   challenge_response: supported
    |_  message_signing: disabled (dangerous, but default)
    | smb2-security-mode:
    |   2.02:
    |_    Message signing enabled but not required
    | smb2-time:
    |   date: 2021-05-14 20:09:39
    |_  start_date: 1600-12-31 23:58:45

    Read data files from: /usr/bin/../share/nmap
    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    # Nmap done at Fri May 14 20:09:40 2021 -- 1 IP address (1 host up) scanned in 13.51 seconds
    ```

## Enum4Linux

```bash
    WARNING: polenum.py is not in your path.  Check that package is installed and your PATH is sane.
    WARNING: ldapsearch is not in your path.  Check that package is installed and your PATH is sane.
    Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Fri May 14 20:24:47 2021

    ==========================
    |    Target Information    |
    ==========================
    Target ........... 10.10.173.69
    RID Range ........ 500-550,1000-1050
    Username ......... ''
    Password ......... ''
    Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


    ====================================================
    |    Enumerating Workgroup/Domain on 10.10.173.69    |
    ====================================================
    [+] Got domain/workgroup name: WORKGROUP

    ============================================
    |    Nbtstat Information for 10.10.173.69    |
    ============================================
    Looking up status of 10.10.173.69
        SKYNET          <00> -         B <ACTIVE>  Workstation Service
        SKYNET          <03> -         B <ACTIVE>  Messenger Service
        SKYNET          <20> -         B <ACTIVE>  File Server Service
        ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE>  Master Browser
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
        WORKGROUP       <1d> -         B <ACTIVE>  Master Browser
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>  Browser Service Elections

        MAC Address = 00-00-00-00-00-00

    =====================================
    |    Session Check on 10.10.173.69    |
    =====================================
    [+] Server 10.10.173.69 allows sessions using username '', password ''

    ===========================================
    |    Getting domain SID for 10.10.173.69    |
    ===========================================
    Domain Name: WORKGROUP
    Domain Sid: (NULL SID)
    [+] Can't determine if host is part of domain or part of a workgroup

    ======================================
    |    OS information on 10.10.173.69    |
    ======================================
    [+] Got OS info for 10.10.173.69 from smbclient:
    [+] Got OS info for 10.10.173.69 from srvinfo:
        SKYNET         Wk Sv PrQ Unx NT SNT skynet server (Samba, Ubuntu)
        platform_id     :	500
        os version      :	6.1
        server type     :	0x809a03

    =============================
    |    Users on 10.10.173.69    |
    =============================
    index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: milesdyson	Name: 	Desc:

    user:[milesdyson] rid:[0x3e8]

    =========================================
    |    Share Enumeration on 10.10.173.69    |
    =========================================
    WARNING: The "syslog" option is deprecated

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        anonymous       Disk      Skynet Anonymous Share
        milesdyson      Disk      Miles Dyson Personal Share
        IPC$            IPC       IPC Service (skynet server (Samba, Ubuntu))
    Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            SKYNET

    [+] Attempting to map shares on 10.10.173.69
    //10.10.173.69/print$	Mapping: DENIED, Listing: N/A
    //10.10.173.69/anonymous	Mapping: OK, Listing: OK
    //10.10.173.69/milesdyson	Mapping: DENIED, Listing: N/A
    //10.10.173.69/IPC$	[E] Can't understand response:
    WARNING: The "syslog" option is deprecated
    NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*

    ====================================================
    |    Password Policy Information for 10.10.173.69    |
    ====================================================
    [E] Dependent program "polenum.py" not present.  Skipping this check.  Download polenum from http://labs.portcullis.co.uk/application/polenum/


    ==============================
    |    Groups on 10.10.173.69    |
    ==============================

    [+] Getting builtin groups:

    [+] Getting builtin group memberships:

    [+] Getting local groups:

    [+] Getting local group memberships:

    [+] Getting domain groups:

    [+] Getting domain group memberships:

    =======================================================================
    |    Users on 10.10.173.69 via RID cycling (RIDS: 500-550,1000-1050)    |
    =======================================================================
    [I] Found new SID: S-1-22-1
    [I] Found new SID: S-1-5-21-2393614426-3774336851-1116533619
    [I] Found new SID: S-1-5-32
    [+] Enumerating users using SID S-1-22-1 and logon username '', password ''
    S-1-22-1-1001 Unix User\milesdyson (Local User)
    [+] Enumerating users using SID S-1-5-32 and logon username '', password ''

    S-1-5-32-543 *unknown*\*unknown* (8)
    S-1-5-32-544 BUILTIN\Administrators (Local Group)
    S-1-5-32-545 BUILTIN\Users (Local Group)
    S-1-5-32-546 BUILTIN\Guests (Local Group)
    S-1-5-32-547 BUILTIN\Power Users (Local Group)
    S-1-5-32-548 BUILTIN\Account Operators (Local Group)
    S-1-5-32-549 BUILTIN\Server Operators (Local Group)
    S-1-5-32-550 BUILTIN\Print Operators (Local Group)
    S-1-5-32-1000 *unknown*\*unknown* (8)
    S-1-5-32-1049 *unknown*\*unknown* (8)
    S-1-5-32-1050 *unknown*\*unknown* (8)
    [+] Enumerating users using SID S-1-5-21-2393614426-3774336851-1116533619 and logon username '', password ''
    S-1-5-21-2393614426-3774336851-1116533619-500 *unknown*\*unknown* (8)
    S-1-5-21-2393614426-3774336851-1116533619-501 SKYNET\nobody (Local User)
    S-1-5-21-2393614426-3774336851-1116533619-502 *unknown*\*unknown* (8)
    S-1-5-21-2393614426-3774336851-1116533619-513 SKYNET\None (Domain Group)
    S-1-5-21-2393614426-3774336851-1116533619-514 *unknown*\*unknown* (8)

    S-1-5-21-2393614426-3774336851-1116533619-1050 *unknown*\*unknown* (8)

    =============================================
    |    Getting printer info for 10.10.173.69    |
    =============================================
    No printers returned.


    enum4linux complete on Fri May 14 20:25:03 2021
```

## Gobuster

#### Command:

```bash
gobuster -u http://10.10.173.69 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 30
```

#### Results

```bash
root@ip-10-10-45-199:~/skynet# gobuster dir -u  http://10.10.173.69 -w /usr/share/wordlists/dirbuster/directory-list
-2.3-medium.txt -t 30
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.173.69
[+] Threads:        30
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/05/14 20:56:30 Starting gobuster
===============================================================
/admin (Status: 301)
/css (Status: 301)
/js (Status: 301)
/config (Status: 301)
/ai (Status: 301)
/squirrelmail (Status: 301)
/server-status (Status: 403)
===============================================================
2021/05/14 20:56:46 Finished
===============================================================
```

### Findings

- **SSH**: 22/tcp open ssh syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
- **HTTP**: 80/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))
- **POP3**: 110/tcp open pop3 syn-ack ttl 64 Dovecot pop3d
- **NetBIOS**: 139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
- **IMAP**: 143/tcp open imap syn-ack ttl 64 Dovecot imapd
- **SMB/AD** Shares: 445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
- [+] Got domain/workgroup name: WORKGROUP
- user:[milesdyson] rid:[0x3e8]
- [+] Got OS info for 10.10.173.69 from smbclient:
  ```bash
  [+] Got OS info for 10.10.173.69 from srvinfo:
  SKYNET Wk Sv PrQ Unx NT SNT skynet server (Samba, Ubuntu)
  platform_id : 500
  os version : 6.1
  server type : 0x809a03
  ```
- [+] Attempting to map shares on 10.10.173.69
  ```bash
  //10.10.173.69/print$	Mapping: DENIED, Listing: N/A
  //10.10.173.69/anonymous	Mapping: OK, Listing: OK
  //10.10.173.69/milesdyson	Mapping: DENIED, Listing: N/A
  //10.10.173.69/IPC$	[E] Can't understand response:
  ```
- Potential lost of password from log1.txt
- Gobuster returned a web dir at 10.10.x.x./squirrelmail (Status: 301)

# Exploitation

## SMBClient

1. First we check to see if we can get into the share anonymously
   ```bash
   $ smbclient //10.10.x.x./anonymous
   ```
1. Once we're successful, let's try to recursively download that directory
   ```bash
   smbget -R smb://10.10.x.x./anonymous
   ```
1. We've successfully downloaded 4 files. One attention.txt and 3 log files
   - attention.txt
     > A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.
     > -Miles Dyson
   - log1.txt
     > cyborg007haloterminator
     > terminator22596
     > terminator219
     > terminator20
     > terminator1989
     > terminator1988
     > terminator168
     > terminator16
     > terminator143
     > terminator13
     > terminator123!@#
     > terminator1056
     > terminator101
     > terminator10
     > terminator02
     > terminator00
     > roboterminator
     > pongterminator
     > manasturcaluterminator
     > exterminator95
     > exterminator200
     > dterminator
     > djxterminator
     > dexterminator
     > determinator
     > cyborg007haloterminator
     > avsterminator
     > alonsoterminator
     > Walterminator
     > 79terminator6
     > 1996terminator
1. After navigating to **http://10.10.x.x./squirrelmail/** e were able to log in with username **milesdyson** and password **cyborg007haloterminator**
1. Upon reading his email, we can see the change password email

   > We have changed your smb password after system malfunction.
   > Password: )s{A&2Z=F^n_E.B`

1. Using smbget, we are able to recursively download his files to investigate
   ```bash
   smbget -U milesdyson -R smb://10.10.x.x/milesdyson
   ```
